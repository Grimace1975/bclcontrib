// Script.WebGLES11.js
(function(){function executeScript(){
Type.registerNamespace('SystemEx.Interop.OpenGL');SystemEx.Interop.OpenGL.$create_ScriptWebGLES11$0=function(){return {};}
SystemEx.Interop.OpenGL.GLXX=function(){}
SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl=function(canvas){this.$2_1C=new Array(4);this.$2_1F=new Array(2);this.$2_20=new Array(2);this.$2_22=new Array(0);this.$2_23=new Array(0);this.$2_24=new Array(0);this.$2_25=new Array(0);SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.initializeBase(this,[canvas.width,canvas.height]);this.$2_26=canvas;this.gl=canvas.getContextWebGL();if(this.gl==null){throw new Error('UnsupportedOperationException: WebGL N/A');}this.$2_27();this.$2_13('initShader');this.$2_21=this.gl.createBuffer();this.$2_13('createBuffer f. elements');for(var $0=0;$0<this.$2_1C.length;$0++){var $1=SystemEx.Interop.OpenGL.$create_ScriptWebGLES11$0();$1.$0=null;$1.$1=this.gl.createBuffer();this.$2_13('createBuffer'+$0);$1.$2=0;$1.$3=0;$1.$4=0;$1.$5=0;$1.$6=false;this.$2_1C[$0]=$1;}}
SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.prototype={$2_11:0,$2_12:function($p0){if(this.$2_11>=1000){return;}console.log(this.$2_11+++': '+$p0);},$2_13:function($p0){var $0=this.gl.getError();if($0!==GLES20.nO_ERROR){this.$2_12('GL_ERROR in '+$p0+'(): '+$0);}},$2_15:null,$2_16:null,$2_17:null,$2_18:null,$2_19:null,$2_1A:null,$2_1B:null,gl:null,$2_1D:0,$2_1E:0,$2_21:null,$2_26:null,$2_27:function(){var $0=this.$2_28(GLES20.verteX_SHADER,'\r\n        attribute vec4 a_position;\r\n        attribute vec4 a_color;\r\n        attribute vec2 a_texCoord0;\r\n        attribute vec2 a_texCoord1;\r\n        uniform mat4 u_mvpMatrix;\r\n        varying vec4 v_color;\r\n        varying vec2 v_texCoord0;\r\n        varying vec2 v_texCoord1;\r\n        void main()\r\n        {\r\n            gl_Position = u_mvpMatrix * a_position;\r\n            v_color = a_color;\r\n            v_texCoord0 = a_texCoord0;\r\n            v_texCoord1 = a_texCoord1;\r\n        }');var $1=this.$2_28(GLES20.fragmenT_SHADER,'\r\n        #ifdef GL_ES\r\n        precision mediump float;\r\n        #endif\r\n        uniform sampler2D s_texture0;\r\n        uniform sampler2D s_texture1;\r\n        uniform int s_texEnv0;\r\n        uniform int s_texEnv1;\r\n        uniform int u_enable_texture_0;\r\n        uniform int u_enable_texture_1;\r\n        varying vec4 v_color;\r\n        varying vec2 v_texCoord0;\r\n        varying vec2 v_texCoord1;\r\n        vec4 finalColor;\r\n        void main()\r\n        {\r\n            finalColor = v_color;\r\n            if (u_enable_texture_0 == 1)\r\n            {\r\n                vec4 texel = texture2D(s_texture0, v_texCoord0);\r\n                if (s_texEnv0 == 1) {\r\n                    finalColor = finalColor * texel;\r\n                } else if (s_texEnv0 == 2) {\r\n                    finalColor = vec4(texel.r, texel.g, texel.b, finalColor.a);\r\n                } else {\r\n                    finalColor = texel;\r\n                }\r\n            }\r\n            if (u_enable_texture_1 == 1) {\r\n                vec4 texel = texture2D(s_texture1, v_texCoord1);\r\n                if (s_texEnv1 == 1) {\r\n                    finalColor = finalColor * texel;\r\n                } else if (s_texEnv1 == 2) {\r\n                    finalColor = vec4(texel.r, texel.g, texel.b, finalColor.a);\r\n                } else {\r\n                    finalColor = texel;\r\n                }\r\n            }\r\n            // simple alpha check\r\n            if (finalColor.a == 0.0) {\r\n                discard;\r\n            }\r\n            float gamma = 1.5;\r\n            float igamma = 1.0 / gamma;\r\n            gl_FragColor = vec4(pow(finalColor.r, igamma), pow(finalColor.g, igamma), pow(finalColor.b, igamma), finalColor.a);\r\n        }');if(($0==null)||($1==null)){throw new Error('RuntimeException: shader error');}var $2=this.gl.createProgram();if(($2==null)||(this.gl.getError()!==GLES20.nO_ERROR)){throw new Error('RuntimeException: program error');}this.gl.attachShader($2,$0);this.gl.attachShader($2,$1);this.gl.bindAttribLocation($2,0,'a_position');this.gl.bindAttribLocation($2,1,'a_color');this.gl.bindAttribLocation($2,2,'a_texCoord0');this.gl.bindAttribLocation($2,3,'a_texCoord1');this.gl.linkProgram($2);this.$2_15=this.gl.getUniformLocation($2,'u_mvpMatrix');this.$2_16=this.gl.getUniformLocation($2,'s_texture0');this.$2_17=this.gl.getUniformLocation($2,'s_texture1');this.$2_18=this.gl.getUniformLocation($2,'s_texEnv0');this.$2_19=this.gl.getUniformLocation($2,'s_texEnv1');this.$2_1A=this.gl.getUniformLocation($2,'u_enable_texture_0');this.$2_1B=this.gl.getUniformLocation($2,'u_enable_texture_1');var $3=this.gl.getProgramParameter($2,GLES20.linK_STATUS);if(!$3){throw new Error('RuntimeException: linker Error: '+this.gl.getProgramInfoLog($2));}this.gl.useProgram($2);this.gl.uniform1i(this.$2_16,0);this.gl.uniform1i(this.$2_17,1);this.gl.activeTexture(GLES20.texturE0);},$2_28:function($p0,$p1){var $0=this.gl.createShader($p0);if($0==null){throw new Error('RuntimeException:');}this.gl.shaderSource($0,$p1);this.gl.compileShader($0);var $1=this.gl.getShaderParameter($0,GLES20.compilE_STATUS);if(!$1){throw new Error('RuntimeException: Shader compile error: '+this.gl.getShaderInfoLog($0));}return $0;},clearColor:function(red,green,blue,alpha){this.gl.clearColor(red,green,blue,alpha);this.$2_13('glClearColor');},color4f:function(red,green,blue,alpha){this.gl.vertexAttrib4f(1,red,green,blue,alpha);this.$2_13('glColor4f');},depthRangef:function(zNear,zFar){this.gl.depthRange(zNear,zFar);this.$2_13('glDepthRangef');},pointParameterf:function(pname,param){},pointParameterfv:function(pname,pparams){},pointSize:function(size){},texParameterf:function(target,pname,param){this.gl.texParameterf(target,pname,param);this.$2_13('glTexParameterf');},texParameterfv:function(target,pname,pparams){},activeTexture:function(texture){this.gl.activeTexture(texture);this.$2_13('glActiveTexture');this.$2_1E=texture-GLES20.texturE0;},bindTexture:function(target,texture){var $0=this.$2_23[texture];if($0==null){$0=this.gl.createTexture();this.$2_23[texture]=$0;}this.gl.bindTexture(target,$0);this.$2_13('glBindTexture');this.$2_1F[this.$2_1E]=texture;},blendFunc:function(sfactor,dfactor){this.gl.blendFunc(sfactor,dfactor);this.$2_13('glBlendFunc');},clear:function(mask){this.gl.clear(mask);this.$2_13('glClear');},clientActiveTexture:function(texture){this.$2_1D=texture-GLES20.texturE0;},colorPointer:function(size,type,stride,pointer){this.$2_2D(1,size,type,true,stride,pointer);this.$2_13('glColorPointer');},cullFace:function(mode){this.gl.cullFace(mode);this.$2_13('glCullFace');},deleteTextures:function(n,textures){for(var $0=0;$0<n;$0++){var $1=SystemEx.IO.SE.readInt32(textures);this.gl.deleteTexture(this.$2_23[$1]);this.$2_13('glDeleteTexture');this.$2_23[$1]=null;}},depthFunc:function(func){this.gl.depthFunc(func);this.$2_13('glDepthFunc');},depthMask:function(flag){this.gl.depthMask(flag);this.$2_13('glDepthMask');},depthRangex:function(zNear,zFar){this.gl.depthRange(zNear,zFar);this.$2_13('glDepthRangex');},disable:function(cap){if(cap!==GLES20.texturE_2D){this.gl.disable(cap);this.$2_13('glDisable');return;}switch(this.$2_1E){case 0:this.gl.uniform1i(this.$2_1A,0);break;case 1:this.gl.uniform1i(this.$2_1B,0);break;default:throw new Error('RuntimeException:');}},disableClientState:function(array){switch(array){case 32886:this.gl.disableVertexAttribArray(1);this.$2_13('DisableClientState colorArr');break;case 32884:this.gl.disableVertexAttribArray(0);this.$2_13('DisableClientState vertexArrr');break;case 32888:switch(this.$2_1D){case 0:this.gl.disableVertexAttribArray(2);this.$2_13('DisableClientState texCoord0');break;case 1:this.gl.disableVertexAttribArray(3);this.$2_13('DisableClientState texCoord1');break;default:throw new Error('RuntimeException:');}break;default:this.$2_12('unsupported / unrecogized client state');break;}},drawArrays:function(mode,first,count){this.$2_2C();this.gl.drawArrays(mode,first,count);this.$2_13('drawArrays');},drawElements:function(mode,count,type,indicies){this.$2_2C();this.gl.bindBuffer(GLES20.elemenT_ARRAY_BUFFER,this.$2_21);this.$2_13('bindBuffer(el)');this.gl.bufferData(GLES20.elemenT_ARRAY_BUFFER,this.$2_2F(indicies,GLES20.unsigneD_SHORT),GLES20.dynamiC_DRAW);this.$2_13('bufferData(el)');this.gl.drawElements(mode,count,GLES20.unsigneD_SHORT,0);this.$2_13('drawElements');},enable:function(cap){if(cap!==GLES20.texturE_2D){this.gl.enable(cap);this.$2_13('glEnable');return;}switch(this.$2_1E){case 0:this.gl.uniform1i(this.$2_1A,1);break;case 1:this.gl.uniform1i(this.$2_1B,1);break;default:throw new Error('RuntimeException:');}},enableClientState:function(array){switch(array){case 32886:this.gl.enableVertexAttribArray(1);this.$2_13('enableClientState colorArr');break;case 32884:this.gl.enableVertexAttribArray(0);this.$2_13('enableClientState vertexArrr');break;case 32888:switch(this.$2_1D){case 0:this.gl.enableVertexAttribArray(2);this.$2_13('enableClientState texCoord0');break;case 1:this.gl.enableVertexAttribArray(3);this.$2_13('enableClientState texCoord1');break;default:throw new Error('RuntimeException:');}break;default:this.$2_12('unsupported / unrecogized client state '+array);break;}},finish:function(){this.gl.finish();},getError:function(){return this.gl.getError();},getString:function(name){return 'glGetString not implemented';},pixelStorei:function(pname,param){this.gl.pixelStorei(pname,param);},pointParameterx:function(pname,param){},pointParameterxv:function(pname,pparams){},pointSizex:function(size){},readPixels:function(x,y,width,height,format,type,pixels){},scissor:function(x,y,width,height){this.gl.scissor(x,y,width,height);this.$2_13('glScissor');},shadeModel:function(mode){},texCoordPointer:function(size,type,stride,pointer){this.$2_2D(2+this.$2_1D,size,type,false,stride,pointer);this.$2_13('texCoordPointer');},texEnvi:function(target,pname,param){this.$2_20[this.$2_1E]=param;},texEnvx:function(target,pname,param){this.$2_20[this.$2_1E]=param;},texEnviv:function(target,pname,pparams){},texEnvxv:function(target,pname,pparams){},texImage2D:function(target,level,internalformat,width,height,border,format,type,pixels){this.$2_25[this.$2_1F[this.$2_1E]]=internalformat;this.gl.texImage2D(target,level,internalformat,width,height,border,format,type,this.$2_2F(pixels,type));this.$2_13('glTexImage2D');},texImage2Di:function(target,level,internalformat,format,type,image){this.gl.texImage2D(target,level,internalformat,format,type,image);this.$2_13('texImage2D');},texImage2De:function(target,level,internalformat,format,type,canvas){this.gl.texImage2D(target,level,internalformat,format,type,canvas);this.$2_13('texImage2D');},texImage2Dx:function(target,level,internalformat,format,type,canvas){this.gl.texImage2D(target,level,internalformat,format,type,canvas);this.$2_13('texImage2D');},texParameteri:function(target,pname,param){this.gl.texParameteri(target,pname,param);this.$2_13('glTexParameteri');},texParameterx:function(target,pname,param){this.gl.texParameteri(target,pname,param);this.$2_13('glTexParameteri');},texParameteriv:function(target,pname,pparams){},texParameterxv:function(target,pname,pparams){},texSubImage2D:function(target,level,xoffset,yoffset,width,height,format,type,pixels){this.gl.texSubImage2D(target,level,xoffset,yoffset,width,height,format,type,this.$2_2F(pixels,type));this.$2_13('glTexSubImage2D');},vertexPointer:function(size,type,stride,pointer){this.$2_2D(0,size,type,false,stride,pointer);this.$2_13('glVertexPointer');},viewport:function(x,y,width,height){SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.callBaseMethod(this, 'viewport',[x,y,width,height]);this.gl.viewport(x,y,width,height);this.$2_13('glViewport');},generateMipmap:function(target){this.gl.generateMipmap(target);this.$2_13('genMipmap');},$2_29:function($p0,$p1){},$2_2A:function($p0){return ((this.$2_20[$p0]===GLES20.REPLACE)?0:((this.$2_24[this.$2_1F[$p0]]===3)?2:1));},$2_2B:function($p0,$p1,$p2){var $0=this.$2_1C[2];this.gl.bindBuffer(GLES20.arraY_BUFFER,$0.$1);var $1=$p0.get_position();var $2=$p0.get_length();$p0.set_position($1+$p1);$p0.setLength($1+$p1+$p2);this.gl.bufferSubData(GLES20.arraY_BUFFER,$p1*4,this.$2_2F($p0,GLES20.FLOAT));$p0.set_position($1);$p0.setLength($2);},$2_2C:function(){if(this.updateMvpMatrix()){this.gl.uniformMatrix4fv(this.$2_15,false,this._mvpMatrix);this.$2_13('prepareDraw');}this.gl.uniform1i(this.$2_18,this.$2_2A(0));this.gl.uniform1i(this.$2_19,this.$2_2A(1));for(var $0=0;$0<4;$0++){var $1=this.$2_1C[$0];if($1.$0!=null){this.gl.bindBuffer(GLES20.arraY_BUFFER,$1.$1);this.$2_13('bindBuffer'+$0);this.gl.bufferData(GLES20.arraY_BUFFER,$1.$0,GLES20.streaM_DRAW);this.$2_13('bufferData'+$0);this.gl.vertexAttribPointer($0,$1.$3,$1.$4,$1.$6,$1.$2,0);this.$2_13('vertexAttribPointer');$1.$0=null;}}},$2_2D:function($p0,$p1,$p2,$p3,$p4,$p5){var $0=this.$2_1C[$p0];$0.$2=$p4;$0.$3=$p1;$0.$6=$p3;$0.$4=$p2;$0.$0=this.$2_2F($p5,$p2);},$2_2E:function($p0,$p1,$p2,$p3,$p4,$p5,$p6,$p7){var $0=this.$2_22[$p7];if($0==null){this.$2_22[$p7]=$0=this.gl.createBuffer();this.gl.bindBuffer(GLES20.arraY_BUFFER,$0);this.gl.bufferData(GLES20.arraY_BUFFER,this.$2_2F($p6,$p2),GLES20.statiC_DRAW);this.$2_13('bufferData');}this.gl.bindBuffer(GLES20.arraY_BUFFER,$0);this.gl.vertexAttribPointer($p0,$p1,$p2,$p3,$p4,$p5);this.$2_13('vertexAttribPointer');this.$2_1C[$p0].$0=null;},$2_2F:function($p0,$p1){var $0=(Type.safeCast($p0,SystemEx.IO.MemoryStream));var $1=null;var $2=($p0.get_length()-$p0.get_position());var $3=0;switch($p1){case GLES20.FLOAT:return new Float32Array($1.buffer,$3,$2/4);case GLES20.unsigneD_BYTE:return new Uint8Array($1.buffer,$3,$2);case GLES20.unsigneD_SHORT:return new Uint16Array($1.buffer,$3,$2/2);case GLES20.INT:return new Int32Array($1.buffer,$3,$2/4);case GLES20.SHORT:return new Int16Array($1.buffer,$3,$2/2);case GLES20.BYTE:return new Int8Array($1.buffer,$3,$2);}throw new Error('IllegalArgumentException:');}}
SystemEx.Interop.OpenGL.WebGLES11RenderingContext=function(width,height){this.$2_0=5888;this.$2_5=new Array(16);this.$2_6=new Array(16);this.$2_7=new Array(16);this.$2_9=[];this.$2_A=[];this.$2_B=[];this.$2_D=new Array(16);this._mvpMatrix=new Array(16);SystemEx.Interop.OpenGL.WebGLES11RenderingContext.initializeBase(this);SystemEx.MathMatrix.setIdentityM(this.$2_6,0);SystemEx.MathMatrix.setIdentityM(this.$2_5,0);SystemEx.MathMatrix.setIdentityM(this.$2_7,0);this.$2_F=width;this.$2_10=height;}
SystemEx.Interop.OpenGL.WebGLES11RenderingContext.prototype={$2_1:0,$2_2:0,$2_3:0,$2_4:0,$2_8:null,$2_C:null,$2_E:true,$2_F:0,$2_10:0,alphaFunc:function(func,r){},frustumf:function(left,right,bottom,top,zNear,zFar){var $0=2*zNear;var $1=right-left;var $2=top-bottom;var $3=zFar-zNear;var $4=[($0/$1),0,0,0,0,($0/$2),0,0,((right+left)/$1),((top+bottom)/$2),((-zFar-zNear)/$3),-1,0,0,((-$0*zFar)/$3),0];this.multMatrixf($4);},getFloatv:function(name,s){switch(name){case 5888:case 2982:var $0=s.get_position();for(var $1=0;$1<this.$2_6.length;$1++){SystemEx.IO.SE.writeSingle(s,this.$2_6[$1]);}s.set_position($0);break;default:throw new Error('ArgumentException: glGetFloat');}},loadMatrixf:function(s){var $0=s.get_position();for(var $1=0;$1<this.$2_8.length;$1++){this.$2_8[$1]=SystemEx.IO.SE.readSingle(s);}s.set_position($0);this.$2_E=true;},multMatrixf:function(m){var $0=0;SystemEx.MathMatrix.multiplyMM(this.$2_D,0,this.$2_8,0,m,$0);SystemEx.JSArrayEx.copy(this.$2_D,0,this.$2_8,0,16);this.$2_E=true;},orthof:function(left,right,bottom,top,zNear,zFar){var $0=[2/(right-left),0,0,0,0,2/(top-bottom),0,0,0,0,-2/zFar-zNear,0,-(right+left)/(right-left),-(top+bottom)/(top-bottom),-(zFar+zNear)/(zFar-zNear),1];this.multMatrixf($0);this.$2_E=true;},rotatef:function(angle,x,y,z){if((x!==0)||(y!==0)||(z!==0)){SystemEx.MathMatrix.rotateM2(this.$2_8,0,angle,x,y,z);}this.$2_E=true;},scalef:function(x,y,z){SystemEx.MathMatrix.scaleM2(this.$2_8,0,x,y,z);this.$2_E=true;},translatef:function(x,y,z){SystemEx.MathMatrix.translateM2(this.$2_8,0,x,y,z);this.$2_E=true;},alphaFuncx:function(func,r){},getIntegerv:function(pname,s){switch(pname){case 2976:SystemEx.IO.SE.writeUInt32(s,this.$2_0);break;default:throw new Error('ArgumentException:');}},loadIdentity:function(){SystemEx.MathMatrix.setIdentityM(this.$2_8,0);this.$2_E=true;},loadMatrixx:function(m){var $0=m.get_position();for(var $1=0;$1<this.$2_8.length;$1++){this.$2_8[$1]=SystemEx.IO.SE.readUInt32(m);}m.set_position($0);this.$2_E=true;},matrixMode:function(mode){switch(mode){case 5888:this.$2_8=this.$2_6;this.$2_C=this.$2_A;break;case 5889:this.$2_8=this.$2_5;this.$2_C=this.$2_9;break;case GLES20.TEXTURE:this.$2_8=this.$2_7;this.$2_C=this.$2_B;break;default:throw new Error('ArgumentException: Unrecoginzed matrix mode: '+mode);}this.$2_0=mode;},orthox:function(left,right,bottom,top,zNear,zFar){var $0=left;var $1=right;var $2=bottom;var $3=zNear;var $4=zFar;var $5=top;var $6=[2/($1-$0),0,0,0,0,2/($5-$2),0,0,0,0,-2/$4-$3,0,-($1+$0)/($1-$0),-($5+$2)/($5-$2),-($4+$3)/($4-$3),1];this.multMatrixf($6);this.$2_E=true;},popMatrix:function(){var $0=this.$2_C.pop();SystemEx.JSArrayEx.copy($0,0,this.$2_8,0,16);this.$2_E=true;},pushMatrix:function(){var $0=new Array(16);SystemEx.JSArrayEx.copy(this.$2_8,0,$0,0,16);this.$2_C.push($0);},scalex:function(x,y,z){SystemEx.MathMatrix.scaleM2(this.$2_8,0,x,y,z);this.$2_E=true;},translatex:function(x,y,z){SystemEx.MathMatrix.translateM2(this.$2_8,0,x,y,z);this.$2_E=true;},viewport:function(x,y,width,height){this.$2_1=x;this.$2_2=y;this.$2_3=width;this.$2_4=height;},updateMvpMatrix:function(){if(!this.$2_E){return false;}SystemEx.MathMatrix.multiplyMM(this._mvpMatrix,0,this.$2_5,0,this.$2_6,0);this.$2_E=false;return true;},project:function(objX,objY,objZ,view,win){var $0=[objX,objY,objZ,1];var $1=new Array(4);SystemEx.MathMatrix.multiplyMV($1,0,this._mvpMatrix,0,$0,0);var $2=$1[3];if($2===0){return false;}var $3=1/$2;win[0]=this.$2_1+this.$2_3*($1[0]*$3+1)*0.5;win[1]=this.$2_2+this.$2_4*($1[1]*$3+1)*0.5;win[2]=($1[2]*$3+1)*0.5;return true;}}
SystemEx.Interop.OpenGL.GLXX.registerClass('SystemEx.Interop.OpenGL.GLXX');SystemEx.Interop.OpenGL.WebGLES11RenderingContext.registerClass('SystemEx.Interop.OpenGL.WebGLES11RenderingContext',WebGLRenderingContext);SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl.registerClass('SystemEx.Interop.OpenGL.WebGLES11RenderingContextImpl',SystemEx.Interop.OpenGL.WebGLES11RenderingContext);SystemEx.Interop.OpenGL.GLXX.arraY_POSITION=0;SystemEx.Interop.OpenGL.GLXX.arraY_COLOR=1;SystemEx.Interop.OpenGL.GLXX.arraY_TEXCOORD_0=2;SystemEx.Interop.OpenGL.GLXX.arraY_TEXCOORD_1=3;SystemEx.Interop.OpenGL.GLXX.QUADS=7;SystemEx.Interop.OpenGL.GLXX.POLYGON=GLES20.trianglE_FAN;SystemEx.Interop.OpenGL.GLXX.simplE_TEXUTRED_QUAD=4294967295;}
ss.loader.registerScript('Script.WebGLES11',['Script.WebEx'],executeScript);})();// This script was generated using Script# v0.6.1.0
